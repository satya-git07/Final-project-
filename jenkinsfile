pipeline {
  agent any

  // Define hardcoded values (replace with your actual values)
  def clusterName = 'my-cluster1'
  def zone = 'us-west3'
  def projectId = 'mypro-443507'
  def gitBranch = 'main'

  stages {
    stage('Git Checkout') {
      steps {
        git url: 'https://github.com/sgandeplli/python.git', branch: gitBranch
      }
    }
    stage('Terraform Init') {
      steps {
        sh 'terraform init'
      }
    }
    stage('Terraform Apply') {
      steps {
        withCredentials([file(credentialsId: 'gcp-sa', variable: 'GOOGLE_APPLICATION_CREDENTIALS')]) {
          sh 'terraform apply -auto-approve'
        }
      }
    }
    stage('Deploy to GKE') {
      steps {
        withCredentials([file(credentialsId: 'gcp-sa', variable: 'GOOGLE_APPLICATION_CREDENTIALS')]) {
          sh 'gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS'
          sh "gcloud container clusters get-credentials $clusterName --zone $zone --project $projectId"
          sh 'kubectl apply -f deploy.yaml'
        }
      }
    }
  }
}
